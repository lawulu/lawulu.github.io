<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ç’æ¿’æ®‰æ¼‚æµè®°</title>
    <link>https://lawulu.github.io/tags/scrapy/feed/index.xml</link>
    <description>Recent content on ç’æ¿’æ®‰æ¼‚æµè®°</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <atom:link href="https://lawulu.github.io/tags/scrapy/feed/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Scrapy</title>
      <link>https://lawulu.github.io/post/Scrapy%E5%88%9D%E7%AA%A5/</link>
      <pubDate>Sat, 15 Oct 2016 00:00:00 +0000</pubDate>
      
      <guid>https://lawulu.github.io/post/Scrapy%E5%88%9D%E7%AA%A5/</guid>
      <description>

&lt;p&gt;æœ€è¿‘å‡ºäºå…´è¶£çœ‹äº†ä¸€ä¸‹Scrapy.ç¬¬ä¸€æ¬¡ä»”ç»†ç ”ç©¶ä¸€ä¸ªPythonæ¡†æ¶,å…ˆè¯´ç»“è®º,çˆ¬è™«åˆ†ä¸ºä¸¤ç§,ä¸€ç§æ˜¯è´ªå©ªçˆ¬è™«,æœ€å¸¸ç”¨çš„å°±æ˜¯æœç´¢å¼•æ“,çœ‹è§Urlå°±çˆ¬.å¦å¤–ä¸€ç§æ˜¯ä¸“ä¸šçˆ¬è™«,ç±»ä¼¼äºç½‘ç»œå°æ•°å®šæœŸæ›´æ–°,ä»·æ ¼æ¯”å¯¹.Scrapyé€‚åˆåšç¬¬äºŒç§.Scrapyä¸“å¿ƒåšçˆ¬å–é€»è¾‘,å…¶ä¼˜åŠ¿æ˜¯æ¡†æ¶æ¯”è¾ƒæˆç†Ÿ,å„ç§æ’ä»¶æ¯”è¾ƒå…¨.å¦‚æœçœŸæ­£åšä¸€ä¸ªå·¥ä¸šåŒ–çš„äº§å“,Scrapyè¿œè¿œä¸å¤Ÿ,è¿˜è¦æ”’å¾ˆå¤šä¸œè¥¿è¿›æ¥.å…¶å®å¦‚æœå¯¹&lt;code&gt;requests&lt;/code&gt;å’Œ&lt;code&gt;beautifulsoup&lt;/code&gt;ç†Ÿæ‚‰,ç›´æ¥ä¸Šè¿™ä¿©å°±æŒºå¥½çš„.&lt;/p&gt;

&lt;h2 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h2&gt;

&lt;p&gt;Scrapyå…¶å®æ˜¯ä¸€ä¸ªå¾ˆè½»é‡çº§æˆ–è€…ç®€å•çš„æ¡†æ¶.å‡ ä¸ªæ¦‚å¿µï¼š
1. &lt;code&gt;Request&lt;/code&gt;,&lt;code&gt;Response&lt;/code&gt;,é¡¾åæ€ä¹‰,å¯¹åº”çš„å°±æ˜¯ç½‘ç»œçš„è¯·æ±‚å’Œå“åº”.
2. &lt;code&gt;Item&lt;/code&gt;æˆ–è€…python dict,å¯¹åº”çš„æ˜¯çˆ¬å–åˆ°çš„ç»“æœ.
3. &lt;code&gt;Pipeline&lt;/code&gt;å¯¹Itemçš„å¤„ç†.
4. &lt;code&gt;Selector&lt;/code&gt;å¯¹åº”çš„æ˜¯å¯¹HTMLçš„å¤„ç†
5. &lt;code&gt;Middleware&lt;/code&gt;ç›¸å½“äºFilter,åˆ†ä¸¤ç§,ä¸€ç§æ˜¯é’ˆå¯¹Spider,ä¸€ç§é’ˆå¯¹ç½‘ç»œè¿æ¥
6. &lt;code&gt;Scheduler&lt;/code&gt;ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆçš„é˜Ÿåˆ—
7. &lt;code&gt;Feed&lt;/code&gt; å®˜æ–¹æä¾›çš„jsonæˆ–è€…json lineçš„è¾“å‡º
8. &lt;code&gt;meta&lt;/code&gt; å¯ä»¥åœ¨å¤šä¸ªSpiderä¹‹é—´ä¼ è¾“æ•°æ®&lt;/p&gt;

&lt;p&gt;å…¶å®æŠŠæ–‡æ¡£çœ‹ä¸€é,ä¸‹ä¸€ä¸ªdemo,å¾ˆå¿«å°±å¯ä»¥è·‘èµ·æ¥.&lt;/p&gt;

&lt;p&gt;çœ‹å›¾å…¶å®å¾ˆæ¸…æ¥šï¼š
&lt;img src=&#34;https://lawulu.github.io/iimg/scrapy.png&#34; alt=&#34;Scrapy Arch&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä»StartRequestå¼€å§‹,ä¸åœçš„è¿”å›Itemæˆ–è€…è¿”å›Request,å¦‚æœè¿”å›Item,å°±å‘åˆ°Pipelineå»å¤„ç†,è¿”å›Request,ç»è¿‡Callbackå¤„ç†ä¹‹å,ç›´åˆ°æ‰€æœ‰çš„Requestéƒ½å˜æˆItem.æ­£æ‰€è°“,ä¸–ç•Œæ˜¯å±äºRequest,å½’æ ¹ç»“åº•è¿˜æ˜¯å±äºItemçš„.&lt;/p&gt;

&lt;h2 id=&#34;ç®€å•ç¤ºä¾‹&#34;&gt;ç®€å•ç¤ºä¾‹&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;import scrapy
class ZhihuSpider(scrapy.Spider):
    name = &amp;quot;zhihu&amp;quot;
    start_urls = [
        &#39;https://www.zhihu.com/explore&#39;,
    ]

    def parse(self, response):
        # self.logger.info(&amp;quot;------zzhonä¸­å›½&amp;quot;)

        for feed in response.css(&#39;.recommend-feed&#39;):
            link = response.urljoin(feed.css(&#39;a::attr(href)&#39;).extract_first());
            yield scrapy.Request(link,callback=self.parse_content)
           

##!!!  print response.css(&#39;#zh-question-detail &amp;gt; div&#39;).extract()[0].encode(&#39;utf-8&#39;)

    def parse_content(self,response):
        yield {
            &#39;title&#39;:response.css(&#39;#zh-question-title &amp;gt; h2 &amp;gt; a::text&#39;).extract_first(),
            &#39;content&#39;:response.css(&#39;#zh-question-detail &amp;gt; div::text&#39;).extract(),
            &#39;link&#39;:response.url
        }

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ç„¶è¿™ä¸ªç¤ºä¾‹è·‘èµ·æ¥ä¹‹å‰,éœ€è¦æ”¹ä¸€äº›é…ç½®æ–‡ä»¶å’Œè®¾ç½®User-agentâ€¦&lt;/p&gt;

&lt;h2 id=&#34;åæ§½&#34;&gt;åæ§½&lt;/h2&gt;

&lt;p&gt;Javaå‡ºèº«çš„ç¨‹åºå‘˜çš„åæ§½â€¦ ä¸ç”¨åœ¨æ„ğŸ˜œ&lt;/p&gt;

&lt;h3 id=&#34;æ—¥å¿—åªæ‰“å°unicodeé—®é¢˜&#34;&gt;æ—¥å¿—åªæ‰“å°Unicodeé—®é¢˜&lt;/h3&gt;

&lt;p&gt;Debugå’Œç›‘æ§èµ·æ¥éå¸¸ä¸æ–¹ä¾¿,æˆ‘çœ‹å®˜æ–¹æŠŠè¿™ä¸ªissueå½“åšwont fixäº†,å¼ºçƒˆæ¨èç›´æ¥ä¸ŠPython3.å¯¹éè‹±æ–‡ä¸–ç•Œæ¥è¯´,Python2ä¸‹scrapy shellç®€ç›´æ²¡äº†å­˜åœ¨çš„å¿…è¦â€¦&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2017-01-15 23:25:54 [scrapy] DEBUG: Scraped from &amp;lt;200 https://www.zhihu.com/question/29218955/answer/41797438&amp;gt; 
{&#39;content&#39;: [u&#39;\u666e\u6d31\u5728\u8fc7\u53bb\u5e94\u8be5\u662f\u4e0d\u4e0a\u53f0\u9762\u7684\u5427\uff1f\u4e5f\u6ca1\u95ee\u662f\u4e0d\u662f\u5c31\u95ee\u4e3a\u4ec0\u4e48\u4e86\uff0c\u5982\u679c\u95ee\u9898\u6709\u9519\u8bef\uff0c\u8bf7\u6307\u6b63&#39;], &#39;link&#39;: &#39;https://www.zhihu.com/question/19258955/answer/42797438&#39;, &#39;title&#39;: u&#39;\u666e\u6d31\u7531\u539f\u6765\u4e0d\u4e0a\u53f0\u9762\u7684\u8fb9\u9500\u8336\u5230\u5982\u4eca\u53d7\u5230\u5e7f\u5927\u8336\u53cb\u559c\u7231\u7684\u8336\u7c7b\uff0c\u9664\u4e86\u7092\u4f5c\u5916\uff0c\u666e\u6d31\u7684\u5de5\u827a\u6216\u8005\u8d28\u91cf\u6709\u4e86\u5f88\u5927\u8fdb\u6b65\u5417\uff1f&#39;} 

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;schedulerå¤ªå¼±&#34;&gt;Schedulerå¤ªå¼±&lt;/h3&gt;

&lt;p&gt;è‡ªå¸¦çš„scheduleråªèƒ½æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆ,å®˜æ–¹æ¨èæ˜¯è‡ªå®¶çš„scrapyd,ç¨å¾®äº†è§£äº†ä¸‹,åº”è¯¥æ˜¯å¯åŠ¨æ—¶å€™æŠŠä»»åŠ¡åˆ†ç»™å¤šä¸ªè¿›ç¨‹,è¿›ç¨‹ä¹‹é—´å¥½åƒæ²¡æ³•äº¤äº’.&lt;/p&gt;

&lt;h3 id=&#34;spider-requestä¹‹é—´å¾ˆéš¾ååŒ&#34;&gt;Spider/Requestä¹‹é—´å¾ˆéš¾ååŒ&lt;/h3&gt;

&lt;p&gt;å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦æŸå‡ ä¸ªRequeståº”è¯¥åœ¨ä¸€ä¸ªç»„é‡Œé¢,åŒä¸€ä¸ªç»„çš„Requestå¯ä»¥å…±ç”¨Cookie,å…±ç”¨ä»£ç†.è¿™ç±»çš„éœ€æ±‚å¯ä»¥é€šè¿‡metaæœºåˆ¶æ¥å®ç°â€¦ç”±äºScrapyçš„Requestæ˜¯æ— è„‘yieldå‡ºæ¥çš„,å®ç°å‡ºæ¥è‚¯å®šå¾ˆä¸‘é™‹.&lt;/p&gt;

&lt;h3 id=&#34;callback-hell&#34;&gt;Callback hell&lt;/h3&gt;

&lt;p&gt;é€šè¿‡Callbackæ¥ç»‘å®šå¤„ç†æ–¹æ³•,å…¥å£å’Œå¯æµ‹è¯•æ€§å¾ˆå·®,æ€ªä¸å¾—è¦åŠ å…¥Contractæœºåˆ¶&lt;/p&gt;

&lt;h3 id=&#34;å®¹é”™&#34;&gt;å®¹é”™&lt;/h3&gt;

&lt;p&gt;å®¹é”™æœºåˆ¶å¾ˆå°‘,éœ€è¦æŠŠTaskæŒä¹…åŒ–,å®˜æ–¹æä¾›çš„æŒä¹…åŒ–åˆ°diskçš„æ–¹æ¡ˆæ„Ÿè§‰å¾ˆåˆçº§å¾ˆç²—ç³™.&lt;/p&gt;

&lt;h2 id=&#34;splash&#34;&gt;Splash&lt;/h2&gt;

&lt;p&gt;Pyspideræ˜¯ç”¨çš„&lt;code&gt;PhantomJS&lt;/code&gt;,Scrapyæä¾›äº†ä¸€ä¸ªåŸºäºDockerå’ŒLuaçš„Splash.
è¿™è´§çš„é—®é¢˜æ˜¯Splashæ²¡æœ‰ä¿æŒæ¸²æŸ“çŠ¶æ€çš„æ–¹æ³•,å¯¹äºå¤æ‚çš„JSäº¤äº’,ä¸€èˆ¬çš„åšæ³•æ˜¯ä¸€ä¸ªluaè„šæœ¬æ‰§è¡Œå¾ˆå¤šæ¬¡,æœ€åè¿”å›æ‰€æœ‰çš„ç»“æœ.è¿™æ ·çˆ¬å–çš„é¢—ç²’æ¯”è¾ƒå¤§,å¦‚æœä¸­é—´å‡ºç°å¼‚å¸¸,ä¸å¥½å¤„ç†,è€Œä¸”è°ƒç”¨&lt;code&gt;splash::wait()&lt;/code&gt;æ€»æ„Ÿè§‰ä¸é è°±,æ²¡æœ‰æä¾›DomåŠ è½½ä¹‹åçš„å›è°ƒå—ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h3&gt;

&lt;p&gt;Splashå¯ä»¥æ‰§è¡ŒLuaè„šæœ¬,å®˜æ–¹å°è£…äº†Splashç±»,å¯ä»¥å’ŒJSäº¤äº’.è¿™æ ·,å°±å¯å¯ä»¥æ‰¾åˆ°Domä¸­çš„Button,ç›´æ¥è°ƒç”¨clickäº‹ä»¶,ç„¶åè¿”å›æŸäº›DOMä¸­çš„Htmlæˆ–è€…Json.&lt;/p&gt;

&lt;h3 id=&#34;lua&#34;&gt;Lua&lt;/h3&gt;

&lt;p&gt;Lua å¾ˆå€¼å¾—ä¸€å­¦,Nginx,æ¸¸æˆå¼•æ“,Rediséƒ½åœ¨ç”¨â€¦â€¦
å¿«é€Ÿå…¥é—¨ï¼š&lt;a href=&#34;http://tylerneylon.com/a/learn-lua/&#34;&gt;http://tylerneylon.com/a/learn-lua/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Luaç¨å¾®å¤æ‚å¹¶ä¸”å¯ä»¥ç©å‡ºèŠ±çš„å†…ç½®æœºåˆ¶å°±æ˜¯Metatableäº†,å¯ä»¥é‡è½½å¯¹å­—å…¸(å¯¹è±¡)å„ç§æ“ä½œç¬¦.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>